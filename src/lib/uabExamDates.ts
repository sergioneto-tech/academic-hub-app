/**
 * Calendário de Provas UAb 2025/2026
 * Fonte: https://portal.uab.pt/wp-content/uploads/2025/12/CALENDARIO_GERAL_202526_V5.pdf
 * Atualizado em 18 de dezembro de 2025
 *
 * Mapa: código da UC → { examDate, resitDate, examPeriod, resitPeriod }
 * Datas em formato YYYY-MM-DD. Período: "M" (manhã 10h) ou "T" (tarde 15h).
 * "*" = a combinar com o docente (sem data fixa).
 */

export type ExamDateEntry = {
  /** Data do exame normal (YYYY-MM-DD) ou null se não há */
  examDate: string | null;
  /** Data do recurso (YYYY-MM-DD) ou null */
  resitDate: string | null;
  /** Período do exame: "M" manhã / "T" tarde */
  examPeriod?: string;
  /** Período do recurso */
  resitPeriod?: string;
};

/** Converte DD-MM-YYYY para YYYY-MM-DD */
function toIso(ddmmyyyy: string): string {
  const [d, m, y] = ddmmyyyy.split("-");
  return `${y}-${m}-${d}`;
}

function entry(examRaw: string | null, resitRaw: string | null): ExamDateEntry {
  const parse = (v: string | null) => {
    if (!v || v === "*" || v.includes("---")) return { date: null, period: undefined };
    const period = v.slice(-1);
    const dateStr = v.slice(0, 10).trim();
    return { date: toIso(dateStr), period };
  };
  const e = parse(examRaw);
  const r = parse(resitRaw);
  return { examDate: e.date, resitDate: r.date, examPeriod: e.period, resitPeriod: r.period };
}

// ── 1º Semestre ────────────────────────────────
const SEM1: Record<string, ExamDateEntry> = {
  "11067": entry("19-02-2026T", "24-07-2026M"),
  "41129": entry("10-02-2026M", "10-07-2026T"),
  "51209": entry("25-02-2026T", "10-07-2026M"),
  "21002": entry("13-02-2026T", "07-07-2026M"),
  "21171": entry("06-02-2026T", "09-07-2026M"),
  "21161": entry("06-02-2026M", "07-07-2026T"),
  "61077": entry("10-02-2026T", "24-07-2026T"),
  "21175": entry("03-02-2026T", "17-07-2026M"),
  "41098": entry("03-02-2026M", "13-07-2026T"),
  "21010": entry("09-02-2026M", "09-07-2026T"),
  "11065": entry("24-02-2026T", "17-07-2026T"),
  "21011": entry("26-01-2026M", "17-07-2026T"),
  "21012": entry("27-01-2026T", "08-07-2026M"),
  "11126": entry("26-01-2026T", "20-07-2026T"),
  "21180": entry("04-02-2026M", "10-07-2026M"),
  "11060": entry("06-02-2026T", "14-07-2026M"),
  "61039": entry("05-02-2026T", "08-07-2026T"),
  "11008": entry("05-02-2026M", "10-07-2026T"),
  "21022": entry("11-02-2026T", "16-07-2026M"),
  "61007": entry("11-02-2026T", "14-07-2026T"),
  "41018": entry("05-02-2026M", "15-07-2026M"),
  "41106": entry("02-02-2026T", "07-07-2026M"),
  "11011": entry("06-02-2026M", "13-07-2026M"),
  "11012": entry("27-01-2026T", "06-07-2026M"),
  "11013": entry("23-02-2026M", "16-07-2026M"),
  "21030": entry("03-02-2026T", "17-07-2026M"),
  "21032": entry("28-01-2026M", "08-07-2026T"),
  "21035": entry("04-02-2026M", "10-07-2026M"),
  "61042": entry("28-01-2026T", "15-07-2026T"),
  "21164": entry("18-02-2026M", "15-07-2026T"),
  "41101": entry("06-02-2026M", "08-07-2026M"),
  "61011": entry("30-01-2026T", "10-07-2026M"),
  "21048": entry("28-01-2026M", "16-07-2026M"),
  "21051": entry("18-02-2026M", "21-07-2026T"),
  "21053": entry("02-02-2026T", "13-07-2026M"),
  "21055": entry("12-02-2026M", "13-07-2026M"),
  "21056": entry("05-02-2026T", "10-07-2026T"),
  "61084": entry("27-01-2026M", "06-07-2026T"),
  "61085": entry("12-02-2026M", "10-07-2026M"),
  "61073": entry("26-01-2026M", "17-07-2026M"),
  "61017": entry("13-02-2026M", "15-07-2026M"),
  "61078": entry("13-02-2026M", "15-07-2026M"),
  "21062": entry("19-02-2026M", "23-07-2026T"),
  "61019": entry("26-01-2026M", "17-07-2026M"),
  "61086": entry("20-02-2026M", "08-07-2026M"),
  "51148": entry("11-02-2026T", "09-07-2026M"),
  "21068": entry("29-01-2026T", "06-07-2026T"),
  "21069": entry("09-02-2026T", "21-07-2026M"),
  "21070": entry("30-01-2026T", "22-07-2026M"),
  "21173": entry(null, null), // a combinar
  "41037": entry("26-01-2026M", "06-07-2026M"),
  "41033": entry("09-02-2026T", "13-07-2026M"),
  "41035": entry("19-02-2026T", "15-07-2026T"),
  "21075": entry("10-02-2026T", "24-07-2026M"),
  "51208": entry("12-02-2026T", "21-07-2026T"),
  "41036": entry("10-02-2026M", "17-07-2026M"),
  "41044": entry("13-02-2026T", "21-07-2026M"),
  "21086": entry("28-01-2026T", "07-07-2026M"),
  "11045": entry("12-02-2026T", "22-07-2026M"),
  "61029": entry("27-01-2026M", "09-07-2026M"),
  "61070": entry("18-02-2026M", "14-07-2026T"),
  "21090": entry(null, null), // a combinar
  "21093": entry("10-02-2026T", "24-07-2026T"),
  "11064": entry("03-02-2026T", "23-07-2026T"),
  "41050": entry("29-01-2026M", "10-07-2026M"),
  "21169": entry("20-02-2026T", "09-07-2026T"),
  "21190": entry("04-02-2026T", "09-07-2026M"),
  "21193": entry("28-01-2026T", "21-07-2026T"),
  "21181": entry("12-02-2026M", "20-07-2026T"),
  "21174": entry("27-01-2026M", "23-07-2026M"),
  "21103": entry("29-01-2026T", "21-07-2026M"),
  "61031": entry("24-02-2026M", "07-07-2026M"),
  "61072": entry("24-02-2026M", "07-07-2026M"),
  "21106": entry("16-02-2026M", "08-07-2026T"),
  "21110": entry("02-02-2026M", "15-07-2026T"),
  "41116": entry("16-02-2026M", "20-07-2026T"),
  "11017": entry("30-01-2026T", "10-07-2026M"),
  "21176": entry(null, null), // a combinar
  "41067": entry("23-02-2026T", "23-07-2026T"),
  "21118": entry(null, "27-07-2026T"), // sem exame normal
  "21192": entry("23-02-2026T", "06-07-2026M"),
  "21120": entry("04-02-2026T", "23-07-2026M"),
  "21159": entry("09-02-2026M", "23-07-2026M"),
  "11063": entry("28-01-2026T", "21-07-2026M"),
  "41038": entry("30-01-2026M", "06-07-2026T"),
  "21079": entry("11-02-2026M", "13-07-2026T"),
  "61079": entry("19-02-2026T", "10-07-2026T"),
  "61071": entry("09-02-2026M", "20-07-2026T"),
  "11068": entry("30-01-2026M", "06-07-2026T"),
  "21089": entry("26-01-2026M", "17-07-2026T"),
  "21078": entry("20-02-2026M", "22-07-2026M"),
  "21101": entry("26-01-2026T", "23-07-2026M"),
  "61020": entry("18-02-2026T", "16-07-2026T"),
  "61096": entry("24-02-2026T", "22-07-2026T"),
  "21041": entry("24-02-2026M", "20-07-2026T"),
  "21166": entry("27-01-2026M", "09-07-2026T"),
  "41102": entry("20-02-2026M", "23-07-2026M"),
  "21036": entry("02-02-2026T", "14-07-2026M"),
  "21133": entry("09-02-2026M", "24-07-2026T"),
  "21167": entry(null, "23-07-2026T"),
  "61046": entry("29-01-2026M", "13-07-2026T"),
  "61053": entry("19-02-2026M", "09-07-2026T"),
  "61087": entry("09-02-2026T", "20-07-2026M"),
  "61041": entry("20-02-2026M", "08-07-2026M"),
  "31030": entry("03-02-2026M", "07-07-2026T"),
  "31041": entry("27-01-2026T", "23-07-2026M"),
  "51143": entry(null, null), // will be in sem2
  "51210": entry(null, null), // will be in sem2
  "51211": entry(null, null), // will be in sem2
  "11028": entry(null, null), // will be in sem2
  "11032": entry(null, null), // will be in sem2
  "11051": entry(null, null), // will be in sem2
  "11061": entry(null, null), // will be in sem2
  "11062": entry(null, null), // will be in sem2
  "21158": entry(null, null), // will be in sem2
  "41020": entry(null, null), // will be in sem2
  "61005": entry(null, null), // will be in sem2
  "61025": entry(null, null), // will be in sem2
  "61027": entry(null, null), // will be in sem2
  "61008": entry("04-02-2026M", "22-07-2026T"),
  "61052": entry("12-02-2026M", "07-07-2026T"),
  "61009": entry("10-02-2026M", "24-07-2026T"),
  "61010": entry("12-02-2026M", "16-07-2026T"),
  "61023": entry("16-02-2026T", "06-07-2026M"),
  "61049": entry("05-02-2026M", "14-07-2026M"),
  "61050": entry("03-02-2026T", "16-07-2026M"),
  "61051": entry("23-02-2026T", "20-07-2026T"),
  "21114": entry("18-02-2026T", "08-07-2026T"),
  "21023": entry("23-02-2026M", "17-07-2026T"),
};

// ── 2º Semestre ────────────────────────────────
const SEM2: Record<string, ExamDateEntry> = {
  "21013": entry("12-06-2026M", "17-09-2026T"),
  "21015": entry("01-07-2026T", "25-09-2026T"),
  "21017": entry("30-06-2026M", "11-09-2026T"),
  "21026": entry("26-06-2026T", "23-09-2026T"),
  "21057": entry("23-06-2026T", "21-09-2026T"),
  "21096": entry("08-06-2026T", "14-09-2026T"),
  "21098": entry("29-06-2026M", "10-09-2026T"),
  "21104": entry("19-06-2026M", "14-09-2026M"),
  "21156": entry("16-06-2026T", "29-09-2026T"),
  "21168": entry("02-07-2026M", "16-09-2026M"),
  "21084": entry("09-06-2026M", "23-09-2026M"),
  "21066": entry("17-06-2026T", "18-09-2026M"),
  "21170": entry("15-06-2026T", "22-09-2026T"),
  "41031": entry("26-06-2026M", "16-09-2026M"),
  "51143_s2": entry("18-06-2026T", "28-09-2026T"), // use original code below
  "51210_s2": entry("09-06-2026T", "25-09-2026T"),
  "51211_s2": entry("16-06-2026T", "24-09-2026T"),
  "41071": entry("19-06-2026M", "09-09-2026M"),
  "41039": entry("09-06-2026M", "29-09-2026M"),
  "41052": entry("15-06-2026M", "14-09-2026M"),
  "41022": entry("16-06-2026M", "15-09-2026T"),
  "41043": entry("22-06-2026M", "17-09-2026T"),
  "41055": entry("29-06-2026M", "24-09-2026T"),
  "41068": entry("02-07-2026M", "21-09-2026T"),
  "41015": entry("11-06-2026M", "10-09-2026T"),
  "41027": entry("25-06-2026T", "23-09-2026T"),
  "41047": entry("15-06-2026M", "17-09-2026T"),
  "41099": entry("12-06-2026M", "15-09-2026M"),
  "41100": entry("23-06-2026M", "22-09-2026M"),
  "41097": entry("23-06-2026T", "14-09-2026M"),
  "41119": entry("11-06-2026T", "25-09-2026T"),
  "41116_s2": entry("16-02-2026M", "20-07-2026T"), // already in sem1
  "21044": entry("18-06-2026T", "18-09-2026T"),
  "61022": entry("08-06-2026M", "10-09-2026M"),
  "41020_s2": entry("30-06-2026T", "10-09-2026T"),
  "41126": entry("30-06-2026T", "10-09-2026T"),
  "41127": entry("23-06-2026T", "14-09-2026M"),
  "61005_s2": entry("12-06-2026T", "14-09-2026T"),
  "61025_s2": entry("17-06-2026M", "21-09-2026T"),
  "61027_s2": entry("26-06-2026T", "24-09-2026T"),
  "61076": entry("26-06-2026T", "24-09-2026T"),
  "61024": entry("01-07-2026T", "25-09-2026T"),
  "61082": entry("01-07-2026T", "25-09-2026T"),
  "61043": entry("17-06-2026T", "10-09-2026M"),
  "61080": entry("17-06-2026T", "10-09-2026M"),
  "61068": entry("22-06-2026M", "15-09-2026M"),
  "61038": entry("25-06-2026T", "22-09-2026T"),
  "61081": entry("25-06-2026T", "22-09-2026T"),
  "61044": entry("02-07-2026T", "29-09-2026T"),
  "61083": entry("12-06-2026M", "17-09-2026M"),
  "61026": entry("12-06-2026M", "17-09-2026M"),
  "21158_s2": entry("22-06-2026T", "18-09-2026M"),
  "21191": entry("22-06-2026T", "18-09-2026M"),
  "11010": entry("23-06-2026T", "30-09-2026T"),
  "11066": entry("16-06-2026T", "29-09-2026T"),
  "11028_s2": entry("12-06-2026T", "14-09-2026T"),
  "11032_s2": entry("19-06-2026T", "16-09-2026T"),
  "11051_s2": entry("02-07-2026T", "23-09-2026M"),
  "11061_s2": entry("09-06-2026M", "10-09-2026T"),
  "11062_s2": entry("25-06-2026T", "21-09-2026T"),
  "11026": entry("29-06-2026T", "10-09-2026M"),
  "11129": entry("22-06-2026T", "28-09-2026M"),
  "11130": entry("17-06-2026T", "24-09-2026T"),
  "21046": entry("12-06-2026T", "25-09-2026T"),
  "21003": entry("02-07-2026M", "10-09-2026M"),
  "21031": entry("11-06-2026T", "23-09-2026T"),
  "21033": entry("01-07-2026M", "14-09-2026T"),
  "21037": entry("15-06-2026T", "15-09-2026T"),
  "21042": entry("29-06-2026T", "18-09-2026T"),
  "21043": entry("16-06-2026T", "21-09-2026T"),
  "21162": entry("08-06-2026M", "24-09-2026M"),
  "21163": entry("23-06-2026T", "16-09-2026T"),
  "21165": entry("18-06-2026T", "18-09-2026T"),
  "21082": entry("26-06-2026M", "25-09-2026T"),
  "21049": entry("25-06-2026T", "22-09-2026T"),
  "21050": entry("29-06-2026T", "15-09-2026T"),
  "21073": entry("02-07-2026T", "28-09-2026T"),
  "21076": entry("17-06-2026M", "17-09-2026M"),
  "21077": entry("02-07-2026M", "21-09-2026M"),
  "21071": entry("29-06-2026M", "14-09-2026M"),
  "21091": entry("19-06-2026M", "29-09-2026T"),
  "21097": entry("16-06-2026M", "10-09-2026M"),
  "21108": entry("09-06-2026M", "29-09-2026T"),
  "21111": entry("11-06-2026M", "23-09-2026M"),
  "21117": entry("09-06-2026T", "22-09-2026T"),
  "21178": entry("18-06-2026T", "28-09-2026M"),
  "21179": entry("25-06-2026M", "09-09-2026T"),
  "21177": entry("30-06-2026T", "11-09-2026M"),
  "21182": entry("01-07-2026M", "16-09-2026M"),
  "21184": entry(null, null), // a combinar
  "21005": entry("19-06-2026T", "09-09-2026T"),
  "21008": entry("15-06-2026T", "15-09-2026T"),
  "21185": entry("30-06-2026T", "22-09-2026T"),
  "21018": entry("22-06-2026T", "22-09-2026T"),
  "21147": entry("16-06-2026T", "11-09-2026M"),
  "31033": entry("11-06-2026T", "14-09-2026T"),
  "31113": entry("17-06-2026T", "16-09-2026T"),
  "31354": entry("02-07-2026T", "29-09-2026T"),
  "61096_s2": entry("24-02-2026T", "22-07-2026T"), // already in sem1 for LEE
  "61074": entry("15-06-2026M", "15-09-2026T"),
  "61075": entry("18-06-2026T", "21-09-2026T"),
  "21195": entry("09-06-2026T", "11-09-2026T"),
  "41128": entry("26-06-2026M", "23-09-2026M"),
  "61093": entry("18-06-2026T", "18-09-2026T"),
  "61037": entry("18-06-2026T", "18-09-2026T"),
  "61069": entry("25-06-2026T", "25-09-2026T"),
  "61002": entry("16-06-2026T", "16-09-2026T"),
  "61036": entry("09-06-2026T", "11-09-2026T"),
  "61006": entry("11-06-2026T", "09-09-2026T"),
  "61012": entry("29-06-2026T", "22-09-2026T"),
  "61048": entry("29-06-2026T", "28-09-2026T"),
  "61054": entry("22-06-2026T", "21-09-2026T"),
  "61055": entry("08-06-2026T", "24-09-2026M"),
  "61057": entry("18-06-2026T", "11-09-2026T"),
  "61045": entry(null, null), // a combinar
  "61088": entry("03-02-2026T", "16-07-2026M"),
  "61089": entry("05-02-2026M", "14-07-2026M"),
  "61091": entry("25-02-2026T", "24-07-2026M"),
  "61092": entry("18-02-2026T", "13-07-2026M"),
  "21088": entry("30-06-2026M", "11-09-2026T"),
  "21083": entry("30-06-2026M", "28-09-2026M"),
  "21100": entry("11-06-2026T", "18-09-2026M"),
  "21099": entry("22-06-2026T", "11-09-2026T"),
};

/**
 * Merged map: all course codes → exam dates.
 * For courses that appear in both semesters, sem2 data is stored separately
 * and looked up by semester context.
 */
const ALL_EXAM_DATES: Record<string, ExamDateEntry> = { ...SEM1, ...SEM2 };

/**
 * Get exam dates for a course code.
 * @param code - The course code (e.g. "21012")
 * @param semester - 1 or 2 to disambiguate courses in both semesters
 */
export function getExamDates(code: string, semester?: number): ExamDateEntry | null {
  // Try semester-specific key first
  if (semester === 2) {
    const s2 = ALL_EXAM_DATES[`${code}_s2`];
    if (s2) return s2;
  }
  return ALL_EXAM_DATES[code] ?? null;
}

/** Link direto para o PDF do calendário de provas */
export const EXAM_CALENDAR_PDF = "https://portal.uab.pt/wp-content/uploads/2025/12/CALENDARIO_GERAL_202526_V5.pdf";
